<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notes â€” Living Letter</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600&family=Crimson+Pro:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .admin-container {
      max-width: 700px;
      margin: 0 auto;
      padding: 100px 24px 60px;
    }
    
    .admin-title {
      font-family: 'Caveat', cursive;
      font-size: 2.5rem;
      color: #5b5bd6;
      margin-bottom: 0.25rem;
    }
    
    .admin-subtitle {
      color: rgba(44, 44, 44, 0.6);
      margin-bottom: 2rem;
    }
    
    .stats-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid rgba(44, 44, 44, 0.08);
      text-align: center;
      min-width: 100px;
    }
    
    .stat-value {
      font-family: 'Caveat', cursive;
      font-size: 2rem;
      color: #5b5bd6;
      line-height: 1;
    }
    
    .stat-label {
      font-size: 0.8rem;
      color: rgba(44, 44, 44, 0.5);
      margin-top: 0.25rem;
    }
    
    .note-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid rgba(44, 44, 44, 0.08);
    }
    
    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }
    
    .note-topic {
      font-family: 'Caveat', cursive;
      font-size: 1.3rem;
      color: #5b5bd6;
    }
    
    .note-date {
      font-size: 0.8rem;
      color: rgba(44, 44, 44, 0.4);
    }
    
    .note-prompt {
      font-size: 0.9rem;
      color: rgba(44, 44, 44, 0.6);
      font-style: italic;
      margin-bottom: 0.75rem;
    }
    
    .note-message {
      background: #fff9f0;
      padding: 1rem;
      border-radius: 8px;
      border-left: 3px solid #5b5bd6;
      line-height: 1.7;
      white-space: pre-wrap;
    }
    
    .note-email {
      margin-top: 0.75rem;
      font-size: 0.85rem;
      color: rgba(44, 44, 44, 0.5);
    }
    
    .note-email a {
      color: #5b5bd6;
      text-decoration: none;
    }
    
    .note-email a:hover { text-decoration: underline; }
    
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: rgba(44, 44, 44, 0.5);
    }
    
    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    .loading {
      text-align: center;
      padding: 3rem;
      color: rgba(44, 44, 44, 0.5);
    }
    
    .error-state {
      text-align: center;
      padding: 3rem;
      color: #dc2626;
    }
    
    .refresh-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: #5b5bd6;
      color: white;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 999px;
      font-family: 'Crimson Pro', serif;
      font-size: 0.95rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(91, 91, 214, 0.3);
      transition: transform 0.15s;
    }
    
    .refresh-btn:hover { transform: translateY(-2px); }
  </style>
</head>
<body>
  <nav class="top-nav" aria-label="Site">
    <a class="top-nav__link" href="index.html">Letter</a>
    <a class="top-nav__link" href="writing.html">Writing</a>
    <a class="top-nav__link" href="reading.html">Reading</a>
  </nav>

  <div class="admin-container">
    <h1 class="admin-title">Submitted Notes</h1>
    <p class="admin-subtitle">Responses from visitors</p>
    
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-value" id="total-count">â€”</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="email-count">â€”</div>
        <div class="stat-label">With Email</div>
      </div>
    </div>
    
    <div id="notes-container">
      <div class="loading">Loading...</div>
    </div>
  </div>
  
  <button class="refresh-btn" onclick="loadNotes()">â†» Refresh</button>
  
  <script src="js/config.js"></script>
  <script>
    const $ = id => document.getElementById(id);
    
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    }
    
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
    
    function renderNotes(notes) {
      const container = $('notes-container');
      
      if (!notes?.length) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ðŸ“­</div>
            <p>No notes yet</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Responses will appear here</p>
          </div>`;
        $('total-count').textContent = '0';
        $('email-count').textContent = '0';
        return;
      }
      
      $('total-count').textContent = notes.length;
      $('email-count').textContent = notes.filter(n => n.email).length;
      
      container.innerHTML = notes.map(note => `
        <div class="note-card">
          <div class="note-header">
            <span class="note-topic">${escapeHtml(note.note_id || 'Note')}</span>
            <span class="note-date">${formatDate(note.created_at || note.timestamp)}</span>
          </div>
          ${note.note_prompt ? `<p class="note-prompt">${escapeHtml(note.note_prompt)}</p>` : ''}
          <div class="note-message">${escapeHtml(note.message || '')}</div>
          <div class="note-email">
            ${note.email ? `ðŸ“§ <a href="mailto:${escapeHtml(note.email)}">${escapeHtml(note.email)}</a>` : 'No email provided'}
          </div>
        </div>
      `).join('');
    }
    
    async function loadNotes() {
      $('notes-container').innerHTML = '<div class="loading">Loading...</div>';
      
      try {
        const res = await fetch(CONFIG.API_NOTES);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        renderNotes(data.notes || []);
      } catch (e) {
        $('notes-container').innerHTML = `
          <div class="error-state">
            <p>Failed to load notes</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">${e.message}</p>
          </div>`;
      }
    }
    
    loadNotes();
    setInterval(loadNotes, 60000); // Refresh every minute
  </script>
</body>
</html>
